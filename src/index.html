<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>onRecord</title>
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.4"></script>
  </head>
  <body>
    <div id="chart"></div>
    <script>
      grist.ready();
      grist.onRecords(drawChart);

      function drawChart(records) {
        const rows = (records || [
          { recorded_at: new Date("2021-01-01").toISOString(), Value: 0 },
          { recorded_at: new Date("2022-01-01").toISOString(), Value: 0 },
        ]).sort((a, b) => a.recorded_at - b.recorded_at);

        const options = {
          x: {
            type: "time",
            domain: [rows[0].recorded_at, rows[rows.length - 1].recorded_at]
          },
          y: {
            grid: true
          },
          marks: [
            Plot.line(rows, { x: "recorded_at", y: "value", stroke: "#16b378" })
          ],
          grid: true,
          marginLeft: 66,
          marginRight: 0,
          marginTop: 0,
          marginBottom: 30,
          insetTop: 20,
          insetBottom: 0,
          insetLeft: 0,
          insetRight: 0
        };

        document.body.appendChild(Plot.plot(options));
      }
    </script>
  </body>
</html>
