<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>onRecord</title>
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.9.0.min.js"></script>
  </head>
  <body>
    <div id="chart"></div>
    <script>
      // grist.ready();
      // grist.onRecord(function(record) {
      //   document.getElementById('readout').innerHTML = JSON.stringify(record, null, 2);
      // });

      {
        drawChart();
      }

      function unpack(rows, key) {
        return rows.map(function (row) { return row[key]; });
      }

      function drawChart() {
        var rows = [
          { Date: new Date("2022-01-01"), Value: 12 },
          { Date: new Date("2022-01-12"), Value: 14 },
          { Date: new Date("2022-01-13"), Value: 33 },
          { Date: new Date("2022-01-23"), Value: 1 },
          { Date: new Date("2022-01-30"), Value: null },
        ]
        var trace1 = {
          type: "scatter",
          mode: "lines",
          name: 'AAPL High',
          x: unpack(rows, 'Date'),
          y: unpack(rows, 'Value'),
          line: { color: '#17BECF' }
        }

        var data = [trace1];

        var layout = {
          title: null,
        };

        var config = { responsive: true };

        Plotly.newPlot('chart', data, layout, config);
      }
    </script>
  </body>
</html>
